\documentclass{standalone}

\usepackage{tikz}
\usetikzlibrary{arrows}
\usetikzlibrary{decorations.markings}
\usepackage{standalone}

\begin{document}

\begin{tikzpicture}

\draw[draw=none] (1, 1) rectangle (28, 18);

% Node bottom
\draw (3.9, 2.1) rectangle (9.3, 3.9);
\draw (9.3, 1.2) rectangle (11.1, 4.8);

% Node middle
\draw (4.8, 8.1) rectangle (12, 9.9);
\draw (3, 7.2) rectangle (4.8, 10.8);

% Node top
\draw (3.9, 14.1) rectangle (9.3, 15.9);
\draw (9.3, 14.1) rectangle (11.1, 15.9);

% Routings
\draw[ultra thick, -triangle 90] (0.5, 15) -- (3.9, 15); % In to top
\draw[ultra thick, -triangle 90] (11.1, 15) -- (14.5, 15); % Out of top

\draw[ultra thick, -triangle 90] (14.5, 9) -- (12, 9); % In to top
\draw[ultra thick, -triangle 90] (3, 9) -- (0.5, 9); % Out of top

\draw[ultra thick, -triangle 90] (0.5, 3) -- (3.9, 3); % In to bottom
\draw[ultra thick, -triangle 90] (11.1, 3) -- (14.5, 3); % Out of bottom

\draw[ultra thick, -triangle 90] (1.75, 9) -- (1.75, 15); % middle to top
\draw[ultra thick, -triangle 90] (1.75, 9) -- (1.75, 3); % middle to bottom

\draw[ultra thick, -triangle 90] (13.25, 15) -- (13.25, 9); % top to middle
\draw[ultra thick, -triangle 90] (13.25, 3) -- (13.25, 9); % bottom to middle

% Top customers
\node[align=center] [style={minimum size=1.4cm, text width=1.0cm, draw=black,fill={rgb:yellow,4;orange,2;white,2},text=black,shape=circle}] at (10.2, 15) {$A_1$};
\node[align=center] [style={minimum size=1.4cm, text width=1.0cm, draw=black,fill={rgb:yellow,4;orange,2;white,2},text=black,shape=circle}] at (4.8, 15) {};
\node[align=center] [style={minimum size=1.4cm, text width=1.0cm, draw=black,fill={rgb:yellow,4;orange,2;white,2},text=black,shape=circle}] at (6.6, 15) {};
\node[align=center] [style={minimum size=1.4cm, text width=1.0cm, draw=black,fill={rgb:yellow,4;orange,2;white,2},text=black,shape=circle}] at (8.4, 15) {};

% Bottom customers
\node[align=center] [style={minimum size=1.4cm, text width=1.0cm, draw=black,fill={rgb:yellow,4;orange,2;white,2},text=black,shape=circle}] at (3.9, 9.9) {$B_1$};
\node[align=center] [style={minimum size=1.4cm, text width=1.0cm, draw=black,fill={rgb:yellow,4;orange,2;white,2},text=black,shape=circle}] at (3.9, 8.1) {$B_2$};
\node[align=center] [style={minimum size=1.4cm, text width=1.0cm, draw=black,fill={rgb:yellow,4;orange,2;white,2},text=black,shape=circle}] at (5.7, 9) {};
\node[align=center] [style={minimum size=1.4cm, text width=1.0cm, draw=black,fill={rgb:yellow,4;orange,2;white,2},text=black,shape=circle}] at (7.5, 9) {};
\node[align=center] [style={minimum size=1.4cm, text width=1.0cm, draw=black,fill={rgb:yellow,4;orange,2;white,2},text=black,shape=circle}] at (9.3, 9) {};
\node[align=center] [style={minimum size=1.4cm, text width=1.0cm, draw=black,fill={rgb:yellow,4;orange,2;white,2},text=black,shape=circle}] at (11.1, 9) {};

% Bottom customers
\node[align=center] [style={minimum size=1.4cm, text width=1.0cm, draw=black,fill={rgb:yellow,4;orange,2;white,2},text=black,shape=circle}] at (10.2, 3.9) {$C_1$};
\node[align=center] [style={minimum size=1.4cm, text width=1.0cm, draw=black,fill={rgb:yellow,4;orange,2;white,2},text=black,shape=circle}] at (10.2, 2.1) {$C_2$};
\node[align=center] [style={minimum size=1.4cm, text width=1.0cm, draw=black,fill={rgb:yellow,4;orange,2;white,2},text=black,shape=circle}] at (4.8, 3) {};
\node[align=center] [style={minimum size=1.4cm, text width=1.0cm, draw=black,fill={rgb:yellow,4;orange,2;white,2},text=black,shape=circle}] at (6.6, 3) {};
\node[align=center] [style={minimum size=1.4cm, text width=1.0cm, draw=black,fill={rgb:yellow,4;orange,2;white,2},text=black,shape=circle}] at (8.4, 3) {};


% B1 to A
\node[align=center] [style={minimum size=1.4cm, text width=1.0cm, draw=black,fill={rgb:yellow,2;orange,4},text=black,shape=circle}] at (3.9, 9.9) {$B_1$};
\draw[gray, dashed, ->] (3.2, 9.9) [bend left=45] to (3.5, 14.4);


% C1 to B
\node[align=center] [style={minimum size=1.4cm, text width=1.0cm, draw=black,fill={rgb:yellow,2;orange,4},text=black,shape=circle}] at (10.2, 3.9) {$C_1$};
\draw[gray, dashed, ->] (10.9, 3.8) [bend right=45] to (12.7, 8.5);


% A1 to B
\node[align=center] [style={minimum size=1.4cm, text width=1.0cm, draw=black,fill={rgb:yellow,2;orange,4},text=black,shape=circle}] at (10.2, 15) {$A_1$};
\draw[gray, dashed, ->] (10.9, 15) [bend left=45] to (12.7, 9.5);


% B2 to A
\node[align=center] [style={minimum size=1.4cm, text width=1.0cm, draw=black,fill={rgb:yellow,2;orange,4},text=black,shape=circle}] at (3.9, 8.1) {$B_2$};
\draw[gray, dashed, ->] (3.2, 8.1) [bend left=45] to (3.3, 14.6);








\pause
% State digraph Nodes
\node (A1) [style={minimum size=2.5cm,draw=black,fill=yellow!40!white,text=black,shape=circle}] at (27.5, 10) {\LARGE{$A_1$}};
\node (B1) [style={minimum size=2.5cm,draw=black,fill=yellow!40!white,text=black,shape=circle}] at (24.045, 14.755) {\LARGE{$B_1$}};
\node (B2) [style={minimum size=2.5cm,draw=black,fill=yellow!40!white,text=black,shape=circle}] at (18.455, 12.939) {\LARGE{$B_2$}};
\node (C1) [style={minimum size=2.5cm,draw=black,fill=yellow!40!white,text=black,shape=circle}] at (18.455, 7.061) {\LARGE{$C_1$}};
\node (C2) [style={minimum size=2.5cm,draw=black,fill=yellow!40!white,text=black,shape=circle}] at (24.045, 5.245) {\LARGE{$C_2$}};


\draw[ultra thick, -triangle 90] (B1) -- (A1);
\draw[ultra thick, -triangle 90] (C1) -- (B1);
\draw[ultra thick, -triangle 90] (C1) -- (B2);
\draw[ultra thick, -triangle 90] (A1) -- (B1);
\draw[ultra thick, -triangle 90] (A1) -- (B2);
\draw[ultra thick, -triangle 90] (B2) -- (A1);


\node[align=center] [style={minimum size=1.4cm, text width=1.0cm, draw=black,fill=red,text=black,shape=circle}] at (3.9, 9.9) {$B_1$};
\node[align=center] [style={minimum size=1.4cm, text width=1.0cm, draw=black,fill=red,text=black,shape=circle}] at (10.2, 15) {$A_1$};
\node[align=center] [style={minimum size=1.4cm, text width=1.0cm, draw=black,fill=red,text=black,shape=circle}] at (3.9, 8.1) {$B_2$};
\draw[red, ultra thick, -triangle 90] (B1) -- (A1);
\draw[red, ultra thick, -triangle 90] (A1) -- (B1);
\draw[red, ultra thick, -triangle 90] (A1) -- (B2);
\draw[red, ultra thick, -triangle 90] (B2) -- (A1);
\node (A1) [style={minimum size=2.5cm,draw=black,fill=red,text=black,shape=circle}] at (27.5, 10) {\LARGE{$A_1$}};
\node (B1) [style={minimum size=2.5cm,draw=black,fill=red,text=black,shape=circle}] at (24.045, 14.755) {\LARGE{$B_1$}};
\node (B2) [style={minimum size=2.5cm,draw=black,fill=red,text=black,shape=circle}] at (18.455, 12.939) {\LARGE{$B_2$}};





\end{tikzpicture}

\end{document}
